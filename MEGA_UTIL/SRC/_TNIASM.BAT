@ECHO OFF

SET ASM=TNIASM
SET ERRCHK=0
SET MODE=NORMAL

:CHECK_OPTION
IF /I "%1"=="/P" (
  SHIFT /1
  SET ERCHK=1
  GOTO :CHECK_OPTION
)
IF /I "%1"=="/S" (
  SHIFT /1
  SET MODE=SIMPLE
  GOTO :CHECK_OPTION
)
IF /I "%1"=="/F" (
  SHIFT /1
  SET MODE=FULL
  GOTO :CHECK_OPTION
)
IF /I "%2"=="/P" SET ERRCHK=1
IF /I "%3"=="/P" SET ERRCHK=1
IF /I "%2"=="/S" SET MODE=SIMPLE
IF /I "%3"=="/S" SET MODE=SIMPLE
IF /I "%2"=="/F" SET MODE=FULL
IF /I "%3"=="/F" SET MODE=FULL

REM %ASM% の存在確認
REM WHERE /Q %ASM%.exe
REM IF ERRORLEVEL 1 GOTO EXE_NOT_FOUND

:ASM
ECHO %ASM% "%1"
%ASM% "%1"
IF ERRORLEVEL 1 GOTO ERR

:REN
IF EXIST "%~n1.SYM" DEL "%~n1.SYM"
ECHO REN %ASM%.SYM "%~n1.SYM"
REN %ASM%.SYM "%~n1.SYM"
EXIT /B

:EXE_NOT_FOUND
ECHO %ASM%.exe が見つかりません。
ECHO 同じフォルダか、Pathの通ったフォルダに %ASM%.exe を置いてください。

:ERR
ECHO.
IF NOT "%ERCHK%"=="1" GOTO ERREND
PAUSE

:ERREND
EXIT /B %ERRORLEVEL%
