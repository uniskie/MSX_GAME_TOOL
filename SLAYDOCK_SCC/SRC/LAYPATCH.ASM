	FNAME	"LAYPATCH.BIN"	;*BINHEAD*
;--> BIN FILE HEADER -->
	DB	0FEH	;*BINHEAD*
	DW	ORGADR	;*BINHEAD*
	DW	ENDFL-1	;*BINHEAD*
	DW	ORGADR	;*BINHEAD*
;<-- BIN FILE HEADER <--
;

;====== SLAYDOCK TOOLS COMMON LABELS ======
	INCLUDE "LAY-DEF.ASM"   ; public addres

ORGADR:	EQU	0D000H
	ORG	ORGADR

;====== SUPER LAYDOC ======
;=== OVER WRITE PROGRAM ===
;    (SEG. DRIVER ¶·¶´)

SEGCH0:	EQU	_LAYHEAD+0
SEGCH1:	EQU	_LAYHEAD+3
SEGCH2:	EQU	_LAYHEAD+6
SEGCH3:	EQU	_LAYHEAD+9
SEGCH4:	EQU	_LAYHEAD+12
SEGCH5:	EQU	_LAYHEAD+15
SEGCH6:	EQU	_LAYHEAD+18
MAP_CR:	EQU	_LAYHEAD+21
DUMMY:	EQU	_LAYHEAD+24

;=== open file ===
WRITER:
	LD	DE,MESG_O
	CALL	F_PRINT

	LD	DE,FCB
	CALL	F_OPEN
	LD	A,20H
	LD	(FCB+15),A

;=== change RAM(2) to RAM(0) ===
	LD	A,3
	OUT	(0FEH),A
	LD	DE,8000H
	CALL	F_DMA

;=== write SEG.0-1 ===
	XOR	A
	LD	(FCB+33),A
	LD	DE,FCB
	LD	HL,2
	CALL	F_READ

	LD	HL,ENTRY1
	EXX
	LD	HL,ENTRY2
	CALL	LOOPM

	XOR	A
	LD	(FCB+33),A
	LD	DE,FCB
	LD	HL,2
	CALL	F_WRITE

;=== write SEG.18H-19H ===
	LD	A,18H
	LD	(FCB+33),A
	LD	DE,FCB
	LD	HL,2
	CALL	F_READ

	LD	HL,ENTRY3
	EXX
	LD	HL,ENTRY4
	CALL	LOOPM

	LD	A,18H
	LD	(FCB+33),A
	LD	DE,FCB
	LD	HL,2
	CALL	F_WRITE

;=== END ===
	LD	DE,FCB
	CALL	F_CLOSE
	LD	A,1
	OUT	(0FEH),A
	RET


;=== over write program ===
LOOPM:	EXX
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL

	LD	A,E
	OR	D
	RET	Z

LOOPF:	EXX
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL

	LD	A,E
	OR	D
	JR	Z,LOOPM

	PUSH	DE
	POP	IX
	EXX
	LD	(IX+0),0CDH	;(CALL nnnnH)
	LD	(IX+1),E
	LD	(IX+2),D
	JP	LOOPF

;====== MAIN DATA ====
FCB:	DB	0
	DB	'SLAYDOCKDAT'
	DW	0
	DW	0H
	DS	21	; (FCB total 37 bytes)
;=== over write data
ENTRY1:	DW	SEGCH0,SEGCH1,SEGCH2,SEGCH3,SEGCH4,DUMMY,0
ENTRY2:	;write adress
	DW	8D9FH,0A0E1H,0A518H,0A6C6H,0B080H,0B23EH,0B375H,0B442H,0B46DH
	DW	8D91H,0A0BEH,0A509H,0A6B7H,0B071H,0B22FH,0B345H,0B412H,0B454H
	DW	0
	DW	8D89H
	DW	8357H,8378H,8385H,8392H,8A3DH,0B854H	;??
	DW	0
	DW	834CH,8D7AH
	DW	0
	DW	82C0H
	DW	0
	DW	8CC3H,8CEAH,8D11H,8D38H,8D5FH
	DW	0
	DW	8CC7H,8CEEH,8D15H,8D3CH,8D63H
	DW	0

ENTRY3:	DW	SEGCH5,SEGCH6,0
ENTRY4:	;writte adress
	DW	8050H,80DFH,80C2H
	DW	0
	DW	8055H,80E4H
	DW	0

;=== MESSAGE ===
MESG_O:	DB	LF,CR
	DB	'=== SUPER LAYDOCK (2Mbit-ROM)==='
	DB	LF,CR
	DB	'OVER WRITER for DISK (MSX2+)'
	DB	LF,CR,ED

;====== INCLUDE ====

	INCLUDE	"MRG-IO.ASM"	;*FILE*

ENDFL:	;
