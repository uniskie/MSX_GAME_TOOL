SETWRT:	EQU	0171H
WRTVRM:	EQU	0177H
;
PMUSIC:	EQU	6006H
;
T_COUNT:	;
	DB	0
;
PLAY_SUB:	;
	LD	A,2
	LD	(PAR_MUS+2),A
	LD	A,(PAR_MUS)
	CALL	SETMUSIC
	LD	HL,2000H
	LD	(PAT_G_TB),HL
	LD	HL,0000H
	LD	(COLOR_TB),HL
	DI
	CALL	SETFONT
;
	CALL	WR_MES@
	DW	3800H
	DB	'XWW PARODIUS :SOUND-BOX WWWWWWWY'	;*DM*
	DB	'V                              V'	;*DM*
	DB	'V SOUND -00-       NOW PLAYING V'	;*DM*
	DB	'V             XWWWWWWWWWWWWWWWYV'	;*DM*
	DB	'V MUSIC -00-  V               VV'	;*DM*
	DB	'V             ZWWWWWWWWWWWWWWW[V'	;*DM*
	DB	'V EXIT         (STOP):STOP-BGM V'	;*DM*
	DB	'ZWWWWWWWWWWWWWW(HOME):FADE-OUT ['	;*DM*
	DB	'¡'
;
	EI
;
;
L_PLAY:	;
	CALL	WR_PNO
	CALL	WR_PNUM
	CALL	WR_TITL
	XOR	A
	LD	(WAITCT),A
	EI
L_PLAYW:	;
	LD	DE,8FFH
	CALL	KEYIN
	CPL
	OR	A
	JP	Z,L_PLAYJ
	LD	A,(WAITCT)	;WAIT INTERVAL
	CP	20		;20/60 SEC
	JR	C,L_PLAYW
L_PLAYJ:	;
	EI
L_PLAY0:	;
	LD	DE,8FFH
	CALL	KEYIN
	LD	HL,P_JUMPT
	LD	B,8
L_PL0:	RLA
	JP	C,J_PL0
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	JP	(HL)
J_PL0:	INC	HL
	INC	HL
	DJNZ	L_PL0
	LD	DE,0710H	;STOP
	CALL	KEYIN
	JP	Z,P_STOP
	JP	L_PLAY0
P_JUMPT:	;
	DW	P_RIGH,P_UP,P_DOWN,P_LEFT
	DW	P_DEL,P_INS,P_HOME,P_SPAC
;
P_LCH:	POP	DE
	LD	A,(PAR_MUS+2)
	CP	2
	JP	Z,L_PLAY
	LD	HL,PAR_MUS+1
	PUSH	DE
	OR	A
	RET	Z
	DEC	HL
	RET
;
P_INS:	LD	C,4
	JP	$+5
P_RIGH:	LD	C,1
	CALL	P_LCH
	OR	A
	JP	NZ,P_ADD2
P_ADD:	LD	A,(HL)
	ADD	A,C
	AND	127
	LD	(HL),A
	JP	L_PLAY
P_ADD2:	LD	A,(HL)
	ADD	A,C
	CP	30H
	JP	C,J_PADD2-2
	CP	3EH
	JP	C,J_PADD2
	LD	A,1
	JP	J_PADD2
	LD	A,30H
J_PADD2:	;
	LD	(HL),A
	JP	L_PLAY
;
P_DEL:	LD	C,4
	JP	$+5
P_LEFT:	LD	C,1
	CALL	P_LCH
	OR	A
	JP	NZ,P_SUB2
P_SUB:	LD	A,(HL)
	SUB	C
	AND	127
	LD	(HL),A
	JP	L_PLAY
P_SUB2:	LD	A,(HL)
	SUB	C
	CP	3EH
	JP	NC,J_PSUB2-2
	OR	A
	JP	Z,J_PSUB2-2
	CP	30H
	JP	NC,J_PSUB2
	LD	A,01H
	JP	J_PSUB2
	LD	A,3DH
J_PSUB2:	;
	LD	(HL),A
	JP	L_PLAY
;
P_DOWN:	LD	A,(PAR_MUS+2)
	DEC	A
	CP	255
	JP	NZ,L_PUD
	LD	A,2
	JP	L_PUD
;
P_UP:	LD	A,(PAR_MUS+2)
	INC	A
	CP	3
	JP	NZ,L_PUD
	XOR	A
L_PUD:	LD	(PAR_MUS+2),A
	JP	L_PLAY
;
P_HOME:	LD	A,81H
	CALL	SETMUSIC
	JP	L_PLAY
;
P_STOP:	LD	A,01H
	CALL	SETMUSIC
	JP	L_PLAY
;
P_SPAC:	LD	A,(PAR_MUS+2)
	CP	2
	JP	Z,PLAY_R
	CALL	P_LCH
	LD	C,(HL)
	JP	Z,J_PL3
	LD	A,1
	CALL	SETMUSIC
	LD	(T_COUNT),A
	LD	A,(T_COUNT)
	OR	A
	JP	NZ,$-1-3
	LD	A,80H
	CALL	SETMUSIC
	LD	A,87H
	CALL	SETMUSIC
J_PL3:	LD	A,C
	CALL	SETMUSIC
	LD	DE,0801H
	CALL	KEYIN
	JP	Z,$-6
	JP	L_PLAY
;
;
WR_PNUM:	;
	DI
	LD	HL,3849H
	CALL	SETWRT
	LD	A,(PAR_MUS+1)
	CALL	WR_PNU_
	LD	HL,3889H
	CALL	SETWRT
	LD	A,(PAR_MUS+0)
	CALL	WR_PNU_
	EI
	RET
WR_PNU_:	;
	LD	B,A
	RRA
	RRA
	RRA
	RRA
	AND	15
	CALL	STR_NUM
	OUT	(VDP),A
	LD	A,B
	AND	15
	CALL	STR_NUM
	OUT	(VDP),A
	RET
;
STR_NUM:	;
	OR	A
	DAA
	CP	10
	JP	C,$+3+1
	INC	A
	ADD	A,30H
	RET
;
WR_PNO:	LD	HL,3841H
	LD	BC,300H
L_PL5:	LD	A,(PAR_MUS+2)
	CP	C
	LD	A,0
	LD	D,0
	JP	NZ,$+7	;TO LD D,A
	LD	A,'<'
	LD	D,'>'
	DI
	CALL	WRTVRM
	LD	A,L
	ADD	A,6
	LD	L,A
	LD	E,A
	LD	A,2
	CP	C
	JP	NZ,$+4
	DEC	L
	LD	A,D
	CALL	WRTVRM
	EI
	LD	L,E
	INC	C
	LD	A,40H-6
	ADD	A,L
	LD	L,A
	DJNZ	L_PL5
	RET
;
;
PLAY_TR:	;
	DI
	CALL	013EH
	CALL	PMUSIC
;
	LD	A,(T_COUNT)
	DEC	A
	LD	(T_COUNT),A
;
	CALL	013EH
;
	LD	A,(WAITCT)
	ADD	A,1
	SBC	A,0	; 255 = STOP
	LD	(WAITCT),A
;
	EI
	RET
;
WAITCT:	DB	0	;WAIT CNT
;
WR_TITL:	;
	DI
	LD	HL,388FH
	CALL	SETWRT
	LD	D,0
	LD	A,(PAR_MUS)
	CP	30H
	JP	C,J_WTIT1-2
	CP	3EH
	JP	C,J_WTIT1
	LD	A,3EH
;
J_WTIT1:	;
	SUB	30H
	RLA
	RLA
	RLA
	RLA
	JP	NC,J_WTIT3
	INC	D
J_WTIT3:	;
	AND	0F0H
	LD	E,A
	LD	HL,MUS_TIT
	ADD	HL,DE
	CALL	WR_MES_
	RET
